{
  "info": {
    "name": "Financial Management API - Complete Collection",
    "description": "Comprehensive API collection for Financial & MLM Management with Razorpay integration",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{admin_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "admin_token",
      "value": "your_admin_jwt_token_here",
      "type": "string"
    },
    {
      "key": "coach_token",
      "value": "your_coach_jwt_token_here",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üîê Authentication",
      "item": [
        {
          "name": "Admin Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/admin/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "auth", "login"]
            },
            "description": "Login as admin to get JWT token"
          }
        },
        {
          "name": "Coach Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"coach@example.com\",\n  \"password\": \"coach123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "login"]
            },
            "description": "Login as coach to get JWT token"
          }
        }
      ]
    },
    {
      "name": "üí∞ Admin Financial Management",
      "item": [
        {
          "name": "üìä Financial Analytics Dashboard",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/admin/financial/analytics-dashboard?timeRange=30",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "analytics-dashboard"],
              "query": [
                {
                  "key": "timeRange",
                  "value": "30",
                  "description": "Number of days to analyze (7, 30, 90, 365)"
                }
              ]
            },
            "description": "Get comprehensive financial analytics dashboard with revenue, commissions, payouts, and platform fees"
          }
        },
        {
          "name": "üè¶ Razorpay Account Management",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/admin/financial/razorpay-account",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "razorpay-account"]
            },
            "description": "Get Razorpay account details, balance, and recent transaction activity"
          }
        },
        {
          "name": "üéØ Update MLM Commission Structure",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"levels\": [\n    {\n      \"level\": 1,\n      \"percentage\": 10\n    },\n    {\n      \"level\": 2,\n      \"percentage\": 5\n    },\n    {\n      \"level\": 3,\n      \"percentage\": 3\n    }\n  ],\n  \"platformFeePercentage\": 5,\n  \"maxLevels\": 3,\n  \"autoPayoutEnabled\": true,\n  \"payoutThreshold\": 100\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/admin/financial/mlm-commission-structure",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "mlm-commission-structure"]
            },
            "description": "Update MLM commission structure with levels, platform fees, and payout settings"
          }
        },
        {
          "name": "‚ö° Process MLM Commission",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"subscriptionId\": \"subscription_id_here\",\n  \"subscriptionAmount\": 1000,\n  \"coachId\": \"coach_id_here\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/admin/financial/process-mlm-commission",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "process-mlm-commission"]
            },
            "description": "Process MLM commission for a specific subscription with automatic payout if enabled"
          }
        },
        {
          "name": "üí≥ Get Platform Fees",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/admin/financial/platform-fees",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "platform-fees"]
            },
            "description": "Get current platform fee settings for different transaction types"
          }
        },
        {
          "name": "üí≥ Update Platform Fees",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"subscriptionFee\": 5.0,\n  \"transactionFee\": 2.0,\n  \"payoutFee\": 1.0,\n  \"refundFee\": 0.5\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/admin/financial/platform-fees",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "platform-fees"]
            },
            "description": "Update platform fees for subscription, transaction, payout, and refund operations"
          }
        }
      ]
    },
    {
      "name": "üë®‚Äçüíº Coach Financial Management",
      "item": [
        {
          "name": "üìà Revenue Analytics",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/coach/financial/revenue?timeRange=30&period=daily",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "revenue"],
              "query": [
                {
                  "key": "timeRange",
                  "value": "30",
                  "description": "Number of days to analyze"
                },
                {
                  "key": "period",
                  "value": "daily",
                  "description": "Period grouping (daily, weekly, monthly)"
                }
              ]
            },
            "description": "Get coach revenue analytics with breakdown by period and commission data"
          }
        },
        {
          "name": "üí≥ Payment History",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/coach/financial/payments?page=1&limit=20&status=active",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "payments"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Items per page"
                },
                {
                  "key": "status",
                  "value": "active",
                  "description": "Filter by payment status (optional)"
                }
              ]
            },
            "description": "Get coach payment history with pagination and filtering options"
          }
        },
        {
          "name": "üè¶ Account Balance",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/coach/financial/balance",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "balance"]
            },
            "description": "Get Razorpay account balance and available payout amount"
          }
        },
        {
          "name": "üí∞ Create Manual Payout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 1000,\n  \"payoutMethod\": \"UPI\",\n  \"upiId\": \"coach@paytm\",\n  \"notes\": \"Monthly payout\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/coach/financial/payout",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "payout"]
            },
            "description": "Create manual payout via UPI or bank transfer"
          }
        },
        {
          "name": "üí∞ Create Bank Payout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 2000,\n  \"payoutMethod\": \"BANK\",\n  \"bankAccount\": {\n    \"accountHolderName\": \"John Doe\",\n    \"accountNumber\": \"1234567890\",\n    \"ifscCode\": \"SBIN0001234\"\n  },\n  \"notes\": \"Bank transfer payout\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/coach/financial/payout",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "payout"]
            },
            "description": "Create manual payout via bank transfer"
          }
        },
        {
          "name": "üìã Payout History",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/coach/financial/payouts?page=1&limit=20&status=processed",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "payouts"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Items per page"
                },
                {
                  "key": "status",
                  "value": "processed",
                  "description": "Filter by payout status (optional)"
                }
              ]
            },
            "description": "Get coach payout history with pagination and filtering"
          }
        },
        {
          "name": "‚öôÔ∏è Update Payout Settings",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"autoPayoutEnabled\": true,\n  \"payoutMethod\": \"UPI\",\n  \"upiId\": \"coach@paytm\",\n  \"minimumAmount\": 500,\n  \"payoutFrequency\": \"weekly\",\n  \"commissionPercentage\": 10\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/coach/financial/payout-settings",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "payout-settings"]
            },
            "description": "Update automatic payout settings and preferences"
          }
        },
        {
          "name": "üéØ MLM Commission Structure",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/coach/financial/mlm-commission",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "mlm-commission"]
            },
            "description": "Get MLM commission structure and coach's commission history"
          }
        },
        {
          "name": "üë• Payout to Another Coach",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"targetCoachId\": \"target_coach_id_here\",\n  \"amount\": 500,\n  \"notes\": \"Commission payout\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/coach/financial/payout-to-coach",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "payout-to-coach"]
            },
            "description": "Create payout to another coach (requires target coach to have auto-payout enabled)"
          }
        },
        {
          "name": "üîÑ Refund History",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/coach/financial/refunds?page=1&limit=20",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "refunds"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Items per page"
                }
              ]
            },
            "description": "Get coach refund history with pagination"
          }
        }
      ]
    },
    {
      "name": "üîß Razorpay Service Integration",
      "item": [
        {
          "name": "üìä Get Account Balance",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/admin/financial/razorpay-account",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "razorpay-account"]
            },
            "description": "Get Razorpay account balance and recent activity"
          }
        },
        {
          "name": "üí∏ Create UPI Payout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 1000,\n  \"upiId\": \"recipient@paytm\",\n  \"purpose\": \"Commission Payout\",\n  \"notes\": \"MLM commission payout\",\n  \"referenceId\": \"COMM_123_456\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/admin/financial/create-upi-payout",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "create-upi-payout"]
            },
            "description": "Create UPI payout via Razorpay API"
          }
        },
        {
          "name": "üè¶ Create Bank Payout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 2000,\n  \"bankAccount\": {\n    \"accountHolderName\": \"John Doe\",\n    \"accountNumber\": \"1234567890\",\n    \"ifscCode\": \"SBIN0001234\"\n  },\n  \"purpose\": \"Commission Payout\",\n  \"notes\": \"MLM commission payout\",\n  \"referenceId\": \"COMM_123_457\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/admin/financial/create-bank-payout",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "create-bank-payout"]
            },
            "description": "Create bank transfer payout via Razorpay API"
          }
        },
        {
          "name": "üìã Get Payout Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/admin/financial/payout-status/payout_id_here",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "payout-status", "payout_id_here"]
            },
            "description": "Get status of a specific payout"
          }
        },
        {
          "name": "üìã Get All Payouts",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/admin/financial/all-payouts?count=10&skip=0&status=processed",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "all-payouts"],
              "query": [
                {
                  "key": "count",
                  "value": "10",
                  "description": "Number of payouts to fetch"
                },
                {
                  "key": "skip",
                  "value": "0",
                  "description": "Number of payouts to skip"
                },
                {
                  "key": "status",
                  "value": "processed",
                  "description": "Filter by payout status"
                }
              ]
            },
            "description": "Get all payouts with filtering options"
          }
        },
        {
          "name": "üí∏ Create Refund",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"paymentId\": \"payment_id_here\",\n  \"amount\": 500,\n  \"notes\": \"Customer requested refund\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/admin/financial/create-refund",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "create-refund"]
            },
            "description": "Create refund for a payment"
          }
        },
        {
          "name": "üìã Get Refund Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/admin/financial/refund-details/refund_id_here",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "refund-details", "refund_id_here"]
            },
            "description": "Get details of a specific refund"
          }
        }
      ]
    },
    {
      "name": "üìä Sample Responses",
      "item": [
        {
          "name": "Financial Analytics Dashboard Response",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/admin/financial/analytics-dashboard",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "financial", "analytics-dashboard"]
            },
            "description": "Sample response for financial analytics dashboard"
          }
        },
        {
          "name": "Coach Revenue Analytics Response",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/coach/financial/revenue",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "revenue"]
            },
            "description": "Sample response for coach revenue analytics"
          }
        },
        {
          "name": "MLM Commission Structure Response",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/coach/financial/mlm-commission",
              "host": ["{{base_url}}"],
              "path": ["api", "coach", "financial", "mlm-commission"]
            },
            "description": "Sample response for MLM commission structure"
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-set authorization header if token is available",
          "if (pm.environment.get('admin_token')) {",
          "    pm.request.headers.add({",
          "        key: 'Authorization',",
          "        value: 'Bearer ' + pm.environment.get('admin_token')",
          "    });",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-save tokens from login responses",
          "if (pm.response.json() && pm.response.json().data && pm.response.json().data.token) {",
          "    pm.environment.set('admin_token', pm.response.json().data.token);",
          "    console.log('Admin token saved to environment');",
          "}",
          "",
          "if (pm.response.json() && pm.response.json().data && pm.response.json().data.coachToken) {",
          "    pm.environment.set('coach_token', pm.response.json().data.coachToken);",
          "    console.log('Coach token saved to environment');",
          "}"
        ]
      }
    }
  ]
}
