{
  "info": {
    "name": "Payment System V1 - API Collection",
    "description": "Complete API collection for testing Payment System V1",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080/api/paymentsv1",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "your-admin-token-here",
      "type": "string"
    },
    {
      "key": "coachToken",
      "value": "your-coach-token-here",
      "type": "string"
    },
    {
      "key": "productId",
      "value": "",
      "type": "string"
    },
    {
      "key": "planId",
      "value": "",
      "type": "string"
    },
    {
      "key": "orderId",
      "value": "",
      "type": "string"
    },
    {
      "key": "paymentId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Health Check",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": ["{{baseUrl}}"],
          "path": ["health"]
        }
      }
    },
    {
      "name": "Admin Product Management",
      "item": [
        {
          "name": "Create Admin Product",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Premium Fitness Transformation Program\",\n  \"description\": \"A comprehensive 12-week fitness program designed for complete body transformation. Includes workout plans, nutrition guides, and progress tracking.\",\n  \"shortDescription\": \"Complete fitness transformation in 12 weeks\",\n  \"category\": \"fitness_training\",\n  \"productType\": \"digital\",\n  \"basePrice\": 2999,\n  \"currency\": \"INR\",\n  \"pricingRules\": {\n    \"allowCustomPricing\": true,\n    \"minPrice\": 1999,\n    \"maxPrice\": 4999,\n    \"suggestedMarkup\": 20\n  },\n  \"features\": [\n    {\n      \"title\": \"12-Week Structured Program\",\n      \"description\": \"Progressive workout plans for all fitness levels\",\n      \"icon\": \"calendar\"\n    },\n    {\n      \"title\": \"Nutrition Guidance\",\n      \"description\": \"Complete meal plans and recipes\",\n      \"icon\": \"food\"\n    },\n    {\n      \"title\": \"Video Demonstrations\",\n      \"description\": \"HD video tutorials for all exercises\",\n      \"icon\": \"play\"\n    },\n    {\n      \"title\": \"Progress Tracking\",\n      \"description\": \"Built-in tools to track your transformation\",\n      \"icon\": \"chart\"\n    }\n  ],\n  \"contentFiles\": [\n    {\n      \"fileName\": \"workout-plan.pdf\",\n      \"fileUrl\": \"/uploads/workout-plan.pdf\",\n      \"fileSize\": 2048000,\n      \"fileType\": \"application/pdf\",\n      \"isDownloadable\": true\n    }\n  ],\n  \"videoContent\": [\n    {\n      \"title\": \"Program Introduction\",\n      \"videoUrl\": \"/uploads/intro-video.mp4\",\n      \"duration\": 300,\n      \"thumbnail\": \"/uploads/intro-thumbnail.jpg\"\n    }\n  ],\n  \"termsAndConditions\": \"By purchasing this program, you agree to follow the workout plans safely and consult a healthcare provider if needed.\",\n  \"refundPolicy\": \"Full refund available within 7 days of purchase.\",\n  \"commissionSettings\": {\n    \"platformCommissionPercentage\": 10,\n    \"coachCommissionPercentage\": 80\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/products",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "products"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('productId', response.data._id);",
                  "    console.log('Product ID saved:', response.data._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get All Admin Products",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/products?page=1&limit=20&status=active",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "products"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "status",
                  "value": "active"
                }
              ]
            }
          }
        },
        {
          "name": "Get Products for Coaches",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/products/available-for-coaches",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "products", "available-for-coaches"]
            }
          }
        },
        {
          "name": "Update Product Status",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"active\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/products/{{productId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "products", "{{productId}}", "status"]
            }
          }
        }
      ]
    },
    {
      "name": "Coach Plan Management",
      "item": [
        {
          "name": "Create Coach Plan",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coachToken}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"adminProductId\": \"{{productId}}\",\n  \"title\": \"Elite Fitness Transformation with Personal Coaching\",\n  \"description\": \"Transform your body with my personalized approach to fitness. This premium program includes everything from the base program plus exclusive personal coaching sessions and custom meal plans tailored to your specific goals.\",\n  \"shortDescription\": \"Premium fitness program with personal coaching\",\n  \"price\": 3999,\n  \"additionalFeatures\": [\n    {\n      \"title\": \"Weekly Personal Coaching Calls\",\n      \"description\": \"30-minute one-on-one coaching sessions every week\",\n      \"icon\": \"phone\"\n    },\n    {\n      \"title\": \"Custom Meal Plans\",\n      \"description\": \"Personalized nutrition plans based on your goals and preferences\",\n      \"icon\": \"food\"\n    },\n    {\n      \"title\": \"24/7 WhatsApp Support\",\n      \"description\": \"Direct access to me via WhatsApp for questions and motivation\",\n      \"icon\": \"message\"\n    }\n  ],\n  \"additionalContentFiles\": [\n    {\n      \"fileName\": \"bonus-workouts.pdf\",\n      \"fileUrl\": \"/uploads/bonus-workouts.pdf\",\n      \"fileSize\": 1024000,\n      \"fileType\": \"application/pdf\",\n      \"isDownloadable\": true\n    }\n  ],\n  \"customTermsAndConditions\": \"This premium program includes personal coaching sessions. All sessions must be scheduled at least 24 hours in advance.\",\n  \"customRefundPolicy\": \"Full refund available within 30 days of purchase.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/coach/plans",
              "host": ["{{baseUrl}}"],
              "path": ["coach", "plans"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('planId', response.data.planId);",
                  "    console.log('Plan ID saved:', response.data.planId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Coach Plans",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coachToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/coach/plans?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["coach", "plans"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "Update Plan Status",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coachToken}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"active\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/coach/plans/{{planId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["coach", "plans", "{{planId}}", "status"]
            }
          }
        },
        {
          "name": "Make Plan Public",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coachToken}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"isPublic\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/coach/plans/{{planId}}",
              "host": ["{{baseUrl}}"],
              "path": ["coach", "plans", "{{planId}}"]
            }
          }
        },
        {
          "name": "Get Coach Plan Stats",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coachToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/coach/plans/stats",
              "host": ["{{baseUrl}}"],
              "path": ["coach", "plans", "stats"]
            }
          }
        }
      ]
    },
    {
      "name": "Public Plan Access",
      "item": [
        {
          "name": "Get Public Plans",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public/plans?page=1&limit=20&category=fitness_training",
              "host": ["{{baseUrl}}"],
              "path": ["public", "plans"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "category",
                  "value": "fitness_training"
                }
              ]
            }
          }
        },
        {
          "name": "Get Plan Details",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public/plans/{{planId}}/details",
              "host": ["{{baseUrl}}"],
              "path": ["public", "plans", "{{planId}}", "details"]
            }
          }
        }
      ]
    },
    {
      "name": "Payment Processing",
      "item": [
        {
          "name": "Create Coach Plan Order",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"planId\": \"{{planId}}\",\n  \"customerId\": \"test_customer_123\",\n  \"customerEmail\": \"test@example.com\",\n  \"customerPhone\": \"+919876543210\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/payments/coach-plan/create-order",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "coach-plan", "create-order"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('orderId', response.data.orderId);",
                  "    console.log('Order ID saved:', response.data.orderId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Create Subscription Order",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"coachId\": \"coach_123\",\n  \"subscriptionPlan\": \"professional\",\n  \"amount\": 999,\n  \"billingCycle\": \"monthly\",\n  \"customerEmail\": \"coach@example.com\",\n  \"customerPhone\": \"+919876543210\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/payments/subscription/create-order",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "subscription", "create-order"]
            }
          }
        },
        {
          "name": "Verify Payment",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"razorpay_order_id\": \"{{orderId}}\",\n  \"razorpay_payment_id\": \"{{paymentId}}\",\n  \"razorpay_signature\": \"{{signature}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/payments/verify",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "verify"]
            }
          }
        },
        {
          "name": "Get Payment by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coachToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/payments/{{paymentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "{{paymentId}}"]
            }
          }
        },
        {
          "name": "Process Refund",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 1999,\n  \"reason\": \"Customer requested partial refund\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/payments/{{paymentId}}/refund",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "{{paymentId}}", "refund"]
            }
          }
        }
      ]
    },
    {
      "name": "Checkout Page System",
      "item": [
        {
          "name": "Get Coach Plan Checkout Data",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/checkout/coach-plan/{{planId}}?customerId=test_customer_123&customerEmail=test@example.com&customerPhone=+919876543210",
              "host": ["{{baseUrl}}"],
              "path": ["checkout", "coach-plan", "{{planId}}"],
              "query": [
                {
                  "key": "customerId",
                  "value": "test_customer_123"
                },
                {
                  "key": "customerEmail",
                  "value": "test@example.com"
                },
                {
                  "key": "customerPhone",
                  "value": "+919876543210"
                }
              ]
            }
          }
        },
        {
          "name": "Get Subscription Checkout Data",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/checkout/subscription?coachId=coach_123&subscriptionPlan=professional&billingCycle=monthly&amount=999",
              "host": ["{{baseUrl}}"],
              "path": ["checkout", "subscription"],
              "query": [
                {
                  "key": "coachId",
                  "value": "coach_123"
                },
                {
                  "key": "subscriptionPlan",
                  "value": "professional"
                },
                {
                  "key": "billingCycle",
                  "value": "monthly"
                },
                {
                  "key": "amount",
                  "value": "999"
                }
              ]
            }
          }
        },
        {
          "name": "Process Checkout Completion",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orderId\": \"{{orderId}}\",\n  \"paymentId\": \"{{paymentId}}\",\n  \"signature\": \"{{signature}}\",\n  \"planId\": \"{{planId}}\",\n  \"customerId\": \"test_customer_123\",\n  \"customerEmail\": \"test@example.com\",\n  \"customerPhone\": \"+919876543210\",\n  \"businessType\": \"coach_plan_purchase\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/checkout/complete",
              "host": ["{{baseUrl}}"],
              "path": ["checkout", "complete"]
            }
          }
        },
        {
          "name": "Get Payment History",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coachToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/checkout/payment-history/test_customer_123?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["checkout", "payment-history", "test_customer_123"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "Generate Checkout URL",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"planId\": \"{{planId}}\",\n  \"businessType\": \"coach_plan_purchase\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/checkout/generate-url",
              "host": ["{{baseUrl}}"],
              "path": ["checkout", "generate-url"]
            }
          }
        }
      ]
    },
    {
      "name": "Webhook Testing",
      "item": [
        {
          "name": "Payment Captured Webhook",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              },
              {
                "key": "X-Razorpay-Signature",
                "value": "{{webhookSignature}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"payment.captured\",\n  \"payload\": {\n    \"payment\": {\n      \"entity\": {\n        \"id\": \"{{paymentId}}\",\n        \"order_id\": \"{{orderId}}\",\n        \"amount\": 399900,\n        \"currency\": \"INR\",\n        \"status\": \"captured\",\n        \"method\": \"card\",\n        \"bank\": \"HDFC\",\n        \"wallet\": null,\n        \"vpa\": null\n      }\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/payments/webhook",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "webhook"]
            }
          }
        },
        {
          "name": "Payment Failed Webhook",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              },
              {
                "key": "X-Razorpay-Signature",
                "value": "{{webhookSignature}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"payment.failed\",\n  \"payload\": {\n    \"payment\": {\n      \"entity\": {\n        \"id\": \"pay_failed_1234567890\",\n        \"order_id\": \"order_failed_1234567890\",\n        \"amount\": 399900,\n        \"currency\": \"INR\",\n        \"status\": \"failed\",\n        \"error_code\": \"BAD_REQUEST_ERROR\",\n        \"error_description\": \"Payment failed due to insufficient funds\"\n      }\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/payments/webhook",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "webhook"]
            }
          }
        }
      ]
    }
  ]
}
